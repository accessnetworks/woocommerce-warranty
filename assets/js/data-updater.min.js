jQuery(document).ready((function(a){var e=a("#progressbar"),t=a(".progress-label"),s=0,n=0,r="";function o(){var e={action:ajax_endpoint,woo_nonce:"",cmd:"update",update_session:r};ajax_params&&(e=a.extend(e,ajax_params)),xhr=a.post(ajaxurl,e,(function(e){if(e.error)a("#log").append('<p class="failure"><span class="dashicons dashicons-no"></span> Error: '+e.error+"</p>");else if("partial"===e.status){p(e.update_data);var t=e.update_data.length;i((s+=t)/n*100),o()}else"completed"===e.status&&(p(e.update_data),a("body").trigger("update_completed"))}))}function l(){!function(){if(i(100),0===a("#log").find("a.return_link").length){a("#log").append('<div class="updated"><p>All done! <a href="#" class="return_link">Go back</a></p></div>');var e=a("#log")[0].scrollHeight;a("#log").scrollTop(e),a(".return_link").attr("href",return_url)}}()}function i(a){e.progressbar("value",Math.ceil(a))}function p(e){for(var t=0;t<e.length;t++){var s,n=e[t].id;s="success"===e[t].status?'<p class="success"><span class="dashicons dashicons-yes"></span> '+(e[t].status_text||entity_label_singular+" #"+n+" "+action_label)+"</p>":'<p class="failure"><span class="dashicons dashicons-no"></span> '+(e[t].status_text||entity_label_singular+" #"+n+" - "+e[t].reason)+"</p>",a("#log").append(s);var r=a("#log")[0].scrollHeight;a("#log").scrollTop(r)}}e.progressbar({value:!1,change:function(){t.text(e.progressbar("value")+"%")},complete:function(){t.text("Update complete!"),a("body").trigger("progress-complete")}}),function(){a("body").bind("update_init_completed",o),a("body").bind("update_completed",l);var e={action:ajax_endpoint,cmd:"start",woo_nonce:""};ajax_params&&(e=a.extend(e,ajax_params)),a("#total-items-label").html("Scanning data. This may take a few minutes."),a.post(ajaxurl,e,(function(e){e?(r=e.update_session,n=e.total_items,a("#total-items-label").html("Total "+entity_label_plural+": "+n),i(0),a("body").trigger("update_init_completed")):alert("There was an error executing the request. Please try again later.")}))}()}));